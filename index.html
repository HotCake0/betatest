<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¹ƒë°œì „ìŸ íŒ€ë³„ ë©€í‹°ë·°</title>
    <style>
        :root {
            --bg-color: #0f0f0f;
            --card-bg: #1e1e1e;
            --red-accent: #ff4d4d;
            --blue-accent: #4d94ff;
            --text-color: #ffffff;
            --offline-color: #555555;
        }

        body {
            font-family: 'Pretendard', -apple-system, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        #selector-container {
            background-color: var(--card-bg);
            display: flex;
            flex-direction: column;
            gap: 5px;
            padding: 10px 20px;
            border-bottom: 2px solid #333;
        }

        .team-row {
            display: flex;
            align-items: center;
            gap: 15px;
            min-height: 50px;
        }

        .team-label {
            font-weight: bold;
            font-size: 0.9rem;
            min-width: 70px;
            padding: 4px 8px;
            border-radius: 4px;
            text-align: center;
        }

        .red-label { background-color: rgba(255, 77, 77, 0.2); color: var(--red-accent); }
        .blue-label { background-color: rgba(77, 148, 255, 0.2); color: var(--blue-accent); }

        .member-list {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 5px;
        }

        /* ë©¤ë²„ ì¹´ë“œ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        .member-card {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #2a2a2a;
            padding: 5px 10px;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: 0.2s;
            white-space: nowrap;
        }

        /* ì˜¤í”„ë¼ì¸ ìŠ¤íƒ€ì¼: íšŒìƒ‰ì¡° ë° í´ë¦­ ë°©ì§€ */
        .member-card.offline {
            filter: grayscale(100%);
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none; /* í´ë¦­ ì´ë²¤íŠ¸ ì°¨ë‹¨ */
        }

        .red-team .member-card.active { border-color: var(--red-accent); background: #3a1a1a; }
        .blue-team .member-card.active { border-color: var(--blue-accent); background: #1a2a3a; }

        .thumb-mini {
            width: 35px;
            height: 22px;
            object-fit: cover;
            border-radius: 3px;
        }

        .info-mini { display: flex; flex-direction: column; }
        .name { font-size: 0.85rem; font-weight: bold; }
        .viewers { font-size: 0.7rem; color: #aaa; }

        /* ë©€í‹°ë·° ê·¸ë¦¬ë“œ */
        #view-grid {
            flex-grow: 1;
            display: grid;
            gap: 5px;
            padding: 5px;
            background: #000;
        }

        .grid-1 { grid-template-columns: 1fr; }
        .grid-2 { grid-template-columns: 1fr 1fr; }
        .grid-4 { grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; }
        .grid-6 { grid-template-columns: 1fr 1fr 1fr; grid-template-rows: 1fr 1fr; }
        .grid-9 { grid-template-columns: 1fr 1fr 1fr; grid-template-rows: repeat(3, 1fr); }

        .video-container {
            position: relative;
            width: 100%;
            height: 100%;
            background: #000;
        }

        iframe { width: 100%; height: 100%; border: none; }

        .no-data {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            color: #666;
        }
    </style>
</head>
<body>

    <div id="selector-container">
        <div class="team-row red-team">
            <div class="team-label red-label">RED TEAM</div>
            <div id="red-member-list" class="member-list"></div>
        </div>
        <div class="team-row blue-team">
            <div class="team-label blue-label">BLUE TEAM</div>
            <div id="blue-member-list" class="member-list"></div>
        </div>
    </div>

    <div id="view-grid" class="grid-1">
        <div class="no-data">ë°©ì†¡ ì¤‘ì¸ ë©¤ë²„ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.</div>
    </div>

    <script>
        // ì„ íƒëœ ë©¤ë²„ì˜ {id: url}ì„ ì €ì¥í•  Map
        let selectedStreams = new Map();
        let redTeamData = [];
        let blueTeamData = [];

        async function loadStatus() {
            try {
                // ìºì‹œ ë°©ì§€ë¥¼ ìœ„í•´ íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ê°€
                const ts = new Date().getTime();
                const [redRes, blueRes] = await Promise.all([
                    fetch(`red_team_status.json?t=${ts}`),
                    fetch(`blue_team_status.json?t=${ts}`)
                ]);
                
                redTeamData = await redRes.json();
                blueTeamData = await blueRes.json();
                
                renderTeamSelector('red-member-list', redTeamData);
                renderTeamSelector('blue-member-list', blueTeamData);
            } catch (error) {
                console.error("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", error);
            }
        }

        function renderTeamSelector(elementId, data) {
            const listEl = document.getElementById(elementId);
            listEl.innerHTML = '';

            data.forEach(member => {
                const card = document.createElement('div');
                // ë°©ì†¡ ìƒíƒœì— ë”°ë¥¸ í´ë˜ìŠ¤ ë¶€ì—¬
                const isLive = member.is_live;
                const isActive = selectedStreams.has(member.id);
                
                card.className = `member-card ${isLive ? '' : 'offline'} ${isActive ? 'active' : ''}`;
                
                // ë°©ì†¡ ì¤‘ì¼ ë•Œë§Œ í´ë¦­ ì´ë²¤íŠ¸ ì—°ê²°
                if (isLive) {
                    card.onclick = () => toggleStream(member.id, member.live_url);
                }
                
                // ì¸ë„¤ì¼ê³¼ ë·°ì–´ ìˆ˜ ì²˜ë¦¬
                const thumb = isLive ? member.thumbnail : 'https://via.placeholder.com/40x25?text=OFF';
                const viewers = isLive ? `ğŸ‘¤ ${member.viewers}` : 'OFFLINE';

                card.innerHTML = `
                    <img class="thumb-mini" src="${thumb}" onerror="this.src='https://via.placeholder.com/40x25'">
                    <div class="info-mini">
                        <span class="name">${member.name}</span>
                        <span class="viewers">${viewers}</span>
                    </div>
                `;
                listEl.appendChild(card);
            });
        }

        function toggleStream(id, liveUrl) {
            if (selectedStreams.has(id)) {
                selectedStreams.delete(id);
            } else {
                // live_url ì£¼ì†Œë¥¼ embedìš©ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ì €ì¥
                const embedUrl = liveUrl.replace('play.sooplive.co.kr/', 'play.sooplive.co.kr/embed/');
                selectedStreams.set(id, embedUrl);
            }
            renderTeamSelector('red-member-list', redTeamData);
            renderTeamSelector('blue-member-list', blueTeamData);
            updateGrid();
        }

        function updateGrid() {
            const gridEl = document.getElementById('view-grid');
            gridEl.innerHTML = '';

            if (selectedStreams.size === 0) {
                gridEl.innerHTML = '<div class="no-data">ë°©ì†¡ ì¤‘ì¸ ë©¤ë²„ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.</div>';
                return;
            }

            const count = selectedStreams.size;
            if (count === 1) gridEl.className = 'grid-1';
            else if (count === 2) gridEl.className = 'grid-2';
            else if (count <= 4) gridEl.className = 'grid-4';
            else if (count <= 6) gridEl.className = 'grid-6';
            else gridEl.className = 'grid-9';

            selectedStreams.forEach((url, id) => {
                const container = document.createElement('div');
                container.className = 'video-container';
                container.innerHTML = `
                    <iframe src="${url}" allowfullscreen></iframe>
                `;
                gridEl.appendChild(container);
            });
        }

        loadStatus();
        setInterval(loadStatus, 30000); // 30ì´ˆë§ˆë‹¤ ìƒíƒœ ì—…ë°ì´íŠ¸
    </script>
</body>
</html>
