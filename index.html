<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¹ƒë°œì „ìŸ íŒ€ë³„ ë©€í‹°ë·°</title>
    <style>
        :root {
            --bg-color: #0f0f0f;
            --card-bg: #1e1e1e;
            --red-accent: #ff4d4d;
            --blue-accent: #4d94ff;
            --text-color: #ffffff;
        }

        body {
            font-family: 'Pretendard', -apple-system, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* íŒ€ë³„ ì„ íƒ ë°” */
        #selector-container {
            background-color: var(--card-bg);
            display: flex;
            flex-direction: column;
            gap: 5px;
            padding: 10px 20px;
            border-bottom: 2px solid #333;
        }

        .team-row {
            display: flex;
            align-items: center;
            gap: 15px;
            min-height: 50px;
        }

        .team-label {
            font-weight: bold;
            font-size: 0.9rem;
            min-width: 70px;
            padding: 4px 8px;
            border-radius: 4px;
            text-align: center;
        }

        .red-label { background-color: rgba(255, 77, 77, 0.2); color: var(--red-accent); }
        .blue-label { background-color: rgba(77, 148, 255, 0.2); color: var(--blue-accent); }

        .member-list {
            display: flex;
            gap: 10px;
            overflow-x: auto;
        }

        .member-card {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #2a2a2a;
            padding: 5px 10px;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: 0.2s;
            white-space: nowrap;
        }

        /* íŒ€ë³„ í™œì„±í™” ìƒ‰ìƒ */
        .red-team .member-card.active { border-color: var(--red-accent); background: #3a1a1a; }
        .blue-team .member-card.active { border-color: var(--blue-accent); background: #1a2a3a; }

        .thumb-mini {
            width: 35px;
            height: 22px;
            object-fit: cover;
            border-radius: 3px;
        }

        .info-mini { display: flex; flex-direction: column; }
        .name { font-size: 0.85rem; font-weight: bold; }
        .viewers { font-size: 0.7rem; color: #aaa; }

        /* ë©€í‹°ë·° ì˜ì—­ */
        #view-grid {
            flex-grow: 1;
            display: grid;
            gap: 5px;
            padding: 5px;
            background: #000;
        }

        .grid-1 { grid-template-columns: 1fr; }
        .grid-2 { grid-template-columns: 1fr 1fr; }
        .grid-3, .grid-4 { grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; }
        .grid-5, .grid-6 { grid-template-columns: 1fr 1fr 1fr; grid-template-rows: 1fr 1fr; }
        .grid-7, .grid-8, .grid-9 { grid-template-columns: 1fr 1fr 1fr; grid-template-rows: repeat(3, 1fr); }

        .video-container {
            position: relative;
            width: 100%;
            height: 100%;
            background: #000;
        }

        iframe { width: 100%; height: 100%; border: none; }

        .no-data {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            color: #666;
        }
    </style>
</head>
<body>

    <div id="selector-container">
        <div class="team-row red-team">
            <div class="team-label red-label">RED TEAM</div>
            <div id="red-member-list" class="member-list"></div>
        </div>
        <div class="team-row blue-team">
            <div class="team-label blue-label">BLUE TEAM</div>
            <div id="blue-member-list" class="member-list"></div>
        </div>
    </div>

    <div id="view-grid" class="grid-1">
        <div class="no-data">ë°©ì†¡ ì¤‘ì¸ ë©¤ë²„ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.</div>
    </div>

    <script>
        let selectedIds = new Set();
        let redTeamData = [];
        let blueTeamData = [];

        // 1. ë‘ ê°œì˜ JSON ë°ì´í„°ë¥¼ ë™ì‹œì— ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadStatus() {
            try {
                const [redRes, blueRes] = await Promise.all([
                    fetch('red_team_status.json'),
                    fetch('blue_team_status.json')
                ]);
                
                redTeamData = await redRes.json();
                blueTeamData = await blueRes.json();
                
                renderTeamSelector('red-member-list', redTeamData);
                renderTeamSelector('blue-member-list', blueTeamData);
            } catch (error) {
                console.error("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", error);
            }
        }

        // 2. íŒ€ë³„ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
        function renderTeamSelector(elementId, data) {
            const listEl = document.getElementById(elementId);
            listEl.innerHTML = '';

            const liveMembers = data.filter(m => m.is_live);

            if (liveMembers.length === 0) {
                listEl.innerHTML = "<span style='font-size: 0.8rem; color: #555;'>LIVE ì—†ìŒ</span>";
                return;
            }

            liveMembers.forEach(member => {
                const card = document.createElement('div');
                card.className = `member-card ${selectedIds.has(member.id) ? 'active' : ''}`;
                card.onclick = () => toggleStream(member.id);
                
                card.innerHTML = `
                    <img class="thumb-mini" src="${member.thumbnail}" onerror="this.src='https://via.placeholder.com/40x25'">
                    <div class="info-mini">
                        <span class="name">${member.name}</span>
                        <span class="viewers">ğŸ‘¤ ${member.viewers}</span>
                    </div>
                `;
                listEl.appendChild(card);
            });
        }

        // 3. í´ë¦­ ì‹œ í† ê¸€
        function toggleStream(id) {
            if (selectedIds.has(id)) {
                selectedIds.delete(id);
            } else {
                selectedIds.add(id);
            }
            // ì „ì²´ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
            renderTeamSelector('red-member-list', redTeamData);
            renderTeamSelector('blue-member-list', blueTeamData);
            updateGrid();
        }

        // 4. ê·¸ë¦¬ë“œ ì—…ë°ì´íŠ¸
        function updateGrid() {
            const gridEl = document.getElementById('view-grid');
            gridEl.innerHTML = '';

            if (selectedIds.size === 0) {
                gridEl.innerHTML = '<div class="no-data">ë°©ì†¡ ì¤‘ì¸ ë©¤ë²„ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.</div>';
                return;
            }

            const count = selectedIds.size;
            if (count === 1) gridEl.className = 'grid-1';
            else if (count === 2) gridEl.className = 'grid-2';
            else if (count <= 4) gridEl.className = 'grid-4';
            else if (count <= 6) gridEl.className = 'grid-6';
            else gridEl.className = 'grid-9';

            selectedIds.forEach(id => {
                const container = document.createElement('div');
                container.className = 'video-container';
                // SOOP ì„ë² ë“œ ì£¼ì†Œ
                container.innerHTML = `
                    <iframe 
                        src="https://play.sooplive.co.kr/embed/${id}" 
                        allowfullscreen>
                    </iframe>
                `;
                gridEl.appendChild(container);
            });
        }

        // ì´ˆê¸° ì‹¤í–‰ ë° 30ì´ˆ ì£¼ê¸° ê°±ì‹ 
        loadStatus();
        setInterval(loadStatus, 30000);
    </script>
</body>
</html>
